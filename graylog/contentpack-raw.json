{
  "v": "1",
  "id": "4ed8569d-19db-4ca7-8f31-4ed562ddf3f2",
  "rev": 4,
  "name": "Satori",
  "summary": "Satori log file processing pipeline and rules",
  "description": "",
  "vendor": "Chatter on the Wire",
  "url": "https://raw.githubusercontent.com/xnih/satori/master/graylog/contentpack-raw.json",
  "parameters": [],
  "entities": [
    {
      "v": "1",
      "type": {
        "name": "pipeline",
        "version": "1"
      },
      "id": "2b0d6fdd-a6cc-48ff-8978-aa9909df3d21",
      "data": {
        "title": {
          "@type": "string",
          "@value": "satori-raw"
        },
        "description": {
          "@type": "string",
          "@value": ""
        },
        "source": {
          "@type": "string",
          "@value": "pipeline \"satori-raw\"\nstage 0 match either\nrule \"process_when_message_contains_DHCP\"\nrule \"process_when_message_contains_TCP\"\nrule \"process_when_message_contains_USERAGENT\"\nrule \"process_when_message_contains_SMBNATIVE_NativeLanMan\"\nrule \"process_when_message_contains_SMBNATIVE_NativeOS\"\nrule \"process_when_message_contains_HTTPSERVER\"\nstage 1 match either\nrule \"convert_timestamp_from_log\"\nend"
        },
        "connected_streams": [
          {
            "@type": "string",
            "@value": "000000000000000000000001"
          }
        ]
      },
      "constraints": [
        {
          "type": "server-version",
          "version": ">=4.0.1+6a0cc0b"
        }
      ]
    },
    {
      "v": "1",
      "type": {
        "name": "pipeline_rule",
        "version": "1"
      },
      "id": "f5f8bcbb-9d6f-46f4-aeb9-58ef9de127ae",
      "data": {
        "title": {
          "@type": "string",
          "@value": "process_when_message_contains_TCP"
        },
        "description": {
          "@type": "string",
          "@value": ""
        },
        "source": {
          "@type": "string",
          "@value": "rule \"process_when_message_contains_TCP\"\nwhen\n  has_field(\"message\") AND contains(to_string($message.message), \";TCP;\")\nthen\n  let extract = grok(pattern: \"%{DATA:timestamp_remote};%{IPV4:src_ip};%{COMMONMAC:src_mac};%{DATA:test_type};%{DATA:tcp_flags};%{DATA:tcp_signature};%{GREEDYDATA:os_guess}\" , value: to_string($message.message), only_named_captures: true);\n  set_fields(extract);\nend"
        }
      },
      "constraints": [
        {
          "type": "server-version",
          "version": ">=4.0.1+6a0cc0b"
        }
      ]
    },
    {
      "v": "1",
      "type": {
        "name": "pipeline_rule",
        "version": "1"
      },
      "id": "187861a2-d826-4cf2-ba4d-3d6d901ecca6",
      "data": {
        "title": {
          "@type": "string",
          "@value": "process_when_message_contains_SMBNATIVE_NativeOS"
        },
        "description": {
          "@type": "string",
          "@value": ""
        },
        "source": {
          "@type": "string",
          "@value": "rule \"process_when_message_contains_SMBNATIVE_NativeOS\"\nwhen\n  has_field(\"message\") AND contains(to_string($message.message), \";SMBNATIVE;NativeOS\")\nthen\n  let extract = grok(pattern: \"%{DATA:timestamp_remote};%{IPV4:src_ip};%{COMMONMAC:src_mac};%{DATA:test_type};%{DATA:native_name};%{GREEDYDATA:os_guess}\" , value: to_string($message.message), only_named_captures: true);\n  set_fields(extract);\nend"
        }
      },
      "constraints": [
        {
          "type": "server-version",
          "version": ">=4.0.1+6a0cc0b"
        }
      ]
    },
    {
      "v": "1",
      "type": {
        "name": "pipeline_rule",
        "version": "1"
      },
      "id": "b1c5abb8-9495-4a1d-b5ab-74f30e921b30",
      "data": {
        "title": {
          "@type": "string",
          "@value": "process_when_message_contains_USERAGENT"
        },
        "description": {
          "@type": "string",
          "@value": ""
        },
        "source": {
          "@type": "string",
          "@value": "rule \"process_when_message_contains_USERAGENT\"\nwhen\n  has_field(\"message\") AND contains(to_string($message.message), \";USERAGENT;\")\nthen\n  let extract = grok(pattern: \"%{DATA:timestamp_remote};%{IPV4:src_ip};%{COMMONMAC:src_mac};%{DATA:test_type};%{DATA:useragent};%{GREEDYDATA:os_guess}\" , value: to_string($message.message), only_named_captures: true);\n  set_fields(extract);\nend"
        }
      },
      "constraints": [
        {
          "type": "server-version",
          "version": ">=4.0.1+6a0cc0b"
        }
      ]
    },
    {
      "v": "1",
      "type": {
        "name": "pipeline_rule",
        "version": "1"
      },
      "id": "21dbb921-e23b-4b2c-969b-14d4f3a3d850",
      "data": {
        "title": {
          "@type": "string",
          "@value": "process_when_message_contains_DHCP"
        },
        "description": {
          "@type": "string",
          "@value": ""
        },
        "source": {
          "@type": "string",
          "@value": "rule \"process_when_message_contains_DHCP\"\nwhen\n  has_field(\"message\") AND contains(to_string($message.message), \";DHCP;\")\nthen\n  let extract = grok(pattern: \"%{DATA:timestamp_remote};%{IPV4:src_ip};%{COMMONMAC:src_mac};%{DATA:test_type};%{DATA:dhcp_message_type};%{DATA:dhcp_field_type};%{DATA:dhcp_field_value};%{GREEDYDATA:os_guess}\" , value: to_string($message.message), only_named_captures: true);\n  set_fields(extract);\nend"
        }
      },
      "constraints": [
        {
          "type": "server-version",
          "version": ">=4.0.1+6a0cc0b"
        }
      ]
    },
    {
      "v": "1",
      "type": {
        "name": "pipeline_rule",
        "version": "1"
      },
      "id": "6e8be4a1-a64e-4ac6-adaa-03a5352e6398",
      "data": {
        "title": {
          "@type": "string",
          "@value": "process_when_message_contains_SMBNATIVE_NativeLanMan"
        },
        "description": {
          "@type": "string",
          "@value": ""
        },
        "source": {
          "@type": "string",
          "@value": "rule \"process_when_message_contains_SMBNATIVE_NativeLanMan\"\nwhen\n  has_field(\"message\") AND contains(to_string($message.message), \";SMBNATIVE;NativeLanMan\")\nthen\n  let extract = grok(pattern: \"%{DATA:timestamp_remote};%{IPV4:src_ip};%{COMMONMAC:src_mac};%{DATA:test_type};%{DATA:native_lanman};%{GREEDYDATA:os_guess}\" , value: to_string($message.message), only_named_captures: true);\n  set_fields(extract);\nend"
        }
      },
      "constraints": [
        {
          "type": "server-version",
          "version": ">=4.0.1+6a0cc0b"
        }
      ]
    },
    {
      "v": "1",
      "type": {
        "name": "pipeline_rule",
        "version": "1"
      },
      "id": "0007d2ed-64ae-4f18-a014-dddc8b472095",
      "data": {
        "title": {
          "@type": "string",
          "@value": "convert_timestamp_from_log"
        },
        "description": {
          "@type": "string",
          "@value": "convert_timestamp_from_log"
        },
        "source": {
          "@type": "string",
          "@value": "rule \"convert_timestamp_from_log\"\nwhen\n  has_field(\"timestamp_remote\")\nthen\n  // the following date format assumes there's no time zone in the string\n  let new_date = parse_date(to_string($message.timestamp_remote), \"yyyy-MM-dd'T'HH:mm:ss\");\n  set_field(\"timestamp\", new_date);\n  remove_field(\"timestamp_remote\");\nend\n\n"
        }
      },
      "constraints": [
        {
          "type": "server-version",
          "version": ">=4.0.1+6a0cc0b"
        }
      ]
    },
    {
      "v": "1",
      "type": {
        "name": "pipeline_rule",
        "version": "1"
      },
      "id": "81cd2fa7-086f-48fa-a111-53f28909a3e9",
      "data": {
        "title": {
          "@type": "string",
          "@value": "process_when_message_contains_HTTPSERVER"
        },
        "description": {
          "@type": "string",
          "@value": ""
        },
        "source": {
          "@type": "string",
          "@value": "rule \"process_when_message_contains_HTTPSERVER\"\nwhen\n  has_field(\"message\") AND contains(to_string($message.message), \";HTTPSERVER;\")\nthen\n  let extract = grok(pattern: \"%{DATA:timestamp_remote};%{IPV4:src_ip};%{COMMONMAC:src_mac};%{DATA:test_type};%{DATA:web_server};%{GREEDYDATA:os_guess}\" , value: to_string($message.message), only_named_captures: true);\n  set_fields(extract);\nend"
        }
      },
      "constraints": [
        {
          "type": "server-version",
          "version": ">=4.0.1+6a0cc0b"
        }
      ]
    }
  ]
}